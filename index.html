<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Water Status Monitor</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        text-align: center;
        background: #111;
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
    h1 {
        margin-bottom: 20px;
    }
    .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 15px;
    }
    .card {
        width: 280px;
        padding: 20px;
        border-radius: 12px;
        font-size: 1.4em;
        font-weight: bold;
        transition: background-color 0.5s ease;
    }
</style>
</head>
<body>
    <h1>üè¢ Water Monitor ‚Äì Floor Status</h1>
    <div class="container">
        <div id="floor1" class="card">Loading Floor 1...</div>
        <div id="floor2" class="card">Loading Floor 2...</div>
    </div>

<script>
// ==================== CONFIG ====================
const channels = {
    floor1: { id: "3036096", field: "1", key: "M1SKX47JKTS0EUA4" }, // ESP1 Channel + Field
    floor2: { id: "3039978", field: "1", key: "XU9D6LUKCSP02Q4H" },  // ESP2 Channel + Field
    floor3: { id: "3038000", field: "1", key: "YYYYYYYYYYYYYYY" }   // ESP3 Channel + Field
};
const fetchInterval = 5000; // every 5s
// =================================================

function fetchData(floorId, config) {
    fetch(`https://api.thingspeak.com/channels/${config.id}/fields/${config.field}/last.json?api_key=${config.key}`)
    .then(response => response.json())
    .then(data => {
        let value = parseInt(data.field1);
        updateStatus(floorId, value);
    })
    .catch(error => {
        console.error("Error fetching data:", error);
        let card = document.getElementById(floorId);
        card.innerText = "Error!";
        card.style.backgroundColor = "gray";
    });
}

function updateStatus(floorId, value) {
    let card = document.getElementById(floorId);
    let floorNum = floorId.replace("floor", "");

    if (value === 1) {
        card.innerText = `üö´ Floor ${floorNum} ‚Äì NOT SAFE`;
        card.style.backgroundColor = "red";
    } else if (value === 2) {
        card.innerText = `‚úÖ Floor ${floorNum} ‚Äì SAFE`;
        card.style.backgroundColor = "green";
    } else if (value === 3) {
        card.innerText = `‚öô Floor ${floorNum} ‚Äì PROCESSING`;
        card.style.backgroundColor = "blue";
    } else {
        card.innerText = `Floor ${floorNum} ‚Äì No Data`;
        card.style.backgroundColor = "gray";
    }
}

// First fetch instantly
Object.entries(channels).forEach(([floor, cfg]) => fetchData(floor, cfg));

// Keep updating all floors
setInterval(() => {
    Object.entries(channels).forEach(([floor, cfg]) => fetchData(floor, cfg));
}, fetchInterval);

</script>
</body>
</html>
